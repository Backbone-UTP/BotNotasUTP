const html2 = `
<html><head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <title>UTP - Reporte de Notas Parciales</title>
		<style type="text/css">
		<!--
			.Estilo4 { font-family: "Times New Roman", Times, serif;font-size: 24px;}
			.Estilo2 { font-family: Verdana, Arial, Helvetica, sans-serif;	font-size: 12px;font-weight: bold;}
			 body    { margin-left: 0px; margin-top: 0px; margin-right: 0px; }
			.Estilo3 {	font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 12px;}
		-->
		</style>
	</head>
<body>
<table width="600" border="0" align="center" cellpadding="0" cellspacing="0">
     	<!-- Encabezado -->
    	<tbody><tr>
      	<td height="140"> 
        	<table width="85%" border="0" align="center" cellpadding="0" cellspacing="0">
          	<tbody><tr>
            	<td width="17%"><img src="http://app4.utp.edu.co/reportes/utp.gif" alt="" width="100" height="100"></td>
              <td width="83%" align="center" class="Estilo4">Universidad Tecnológica de Pereira<br>Reporte de Notas Parciales</td>
            </tr>
          </tbody></table>        </td>
      </tr>
      <!-- Fin Encabezado -->
      <!-- InfoEstudiante -->
      <tr>
      	<td>
        	<table width="90%" border="0" align="center" cellpadding="0" cellspacing="0">
          	<tbody><tr>
            	<td width="21%"><span class="Estilo2">1004995317&nbsp;&nbsp;</span></td>
              <td width="52%"><span class="Estilo2">Jhon Alex Gaviria Tobon</span></td>
              <td width="27%"><div align="center"><span class="Estilo2">09/04/2023</span></div></td>
            </tr>
          </tbody></table>        </td>
      </tr>
      <!-- Fin InfoEstudiante -->
			      <!--  Inicio Asignatura -->
            test
      <tr>
      	<td class="Estilo3">&nbsp;</td>
      </tr>
      <tr>
      	<td>
          <table width="100%" border="0" align="center" cellpadding="2" cellspacing="0" bgcolor="#CCCCCC">
          	<tbody><tr>
            	<td>
              	<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
                	<tbody><tr>
                  	<td width="100%" height="20" class="Estilo2">IS753 - COMPILADORES - Grupo 2 </td>
                  </tr>
                                    <!-- Inicio Modulo -->
                  <tr>
                  	<td bgcolor="#FFFFFF"></td>
                  </tr>
                  <tr>
                  	<td bgcolor="#FFFFFF">
                    	<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
                      	<tbody><tr>
                        	<td width="27%" class="Estilo2">Módulo 1 Docente</td>
                          <td colspan="3" class="Estilo3">&nbsp;</td>
                        </tr>
                        <tr align="center">
                        	<td class="Estilo2">Nota del Definitiva</td>
                          <td class="Estilo2">Nota del Módulo</td>
                          <td class="Estilo2">Nota Habilitada</td>
                        </tr>
                        
                        <tr align="center">
                        	<td width="33%" class="Estilo3">1.0</td>
                          <td width="34%" class="Estilo3">1.0</td>
                          <td width="33%" class="Estilo3">No Aplica</td>
                        </tr>
                        <!--
                        <tr>
                        	<td class="Estilo2">Nota del M&oacute;dulo</td>
                          <td width="12%" class="Estilo3">&nbsp;</td>
                          <td width="40%" class="Estilo2" align="right">
                                                    Nota Habiliaci&oacute;n:
                                                    </td>
                          <td width="21%"><div align="center" class="Estilo3">
													&nbsp;</div></td>
                        </tr>
                        <tr>
                        	<td class="Estilo2" colspan="4">&nbsp;</td>
                        </tr>-->
                        <tr>
                        	<td colspan="4">
                          	<!-- Actividades -->
                          	<table width="100%" border="0" cellpadding="2" cellspacing="0" bgcolor="#EAEAEA">
                              <tbody><tr>
                                <td>
                                	<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
                                  	<tbody><tr>
                                    	<td width="44%" bgcolor="#CCCCCC" class="Estilo2">Actividad</td>
                                    	<td width="26%" bgcolor="#CCCCCC" align="center" class="Estilo2">Fecha Digitación</td>
                                    	<td width="14%" bgcolor="#CCCCCC" align="center" class="Estilo2">Porcentaje</td>
                                    	<td width="10%" bgcolor="#CCCCCC" align="center" class="Estilo2">Nota</td>
                                      
                                    </tr>
                                  	                                  	<tr bgcolor="#F4F4F4">
                                    	<td class="Estilo3">&nbsp;&nbsp;&nbsp;&nbsp;Lexer&nbsp;</td>
                                    	<td align="center" class="Estilo3">27/03/23&nbsp;</td>
                                    	<td align="center" class="Estilo3">10 %&nbsp;</td>
                                    	<td align="center" class="Estilo3">3.800&nbsp;</td>
                                      
                                  	</tr>
                                  	                                  	<tr bgcolor="#FFFFFF">
                                    	<td class="Estilo3">Compilador&nbsp;MiniC&nbsp;</td>
                                    	<td align="center" class="Estilo3">27/03/23&nbsp;</td>
                                    	<td align="center" class="Estilo3">50 %&nbsp;</td>
                                    	<td align="center" class="Estilo3">0.380&nbsp;</td>
                                      
                                  	</tr>
                                  	                                  	<tr bgcolor="#F4F4F4">
                                    	<td class="Estilo3">Parcial&nbsp;I&nbsp;</td>
                                    	<td align="center" class="Estilo3">27/03/23&nbsp;</td>
                                    	<td align="center" class="Estilo3">25 %&nbsp;</td>
                                    	<td align="center" class="Estilo3">3.300&nbsp;</td>
                                      
                                  	</tr>
                                  	                                	</tbody></table>
                                </td>
                              </tr>
                            </tbody></table>
                          	<!-- Fin Actividades -->                          
                          </td>
                        </tr>
                      </tbody></table>
                    </td>
                  </tr>
                  <!-- Fin Modulo -->
                                    <tr>
                    <td bgcolor="#FFFFFF" class="Estilo3" align="center">&nbsp;</td>
                  </tr>
                </tbody></table>
              </td>
            </tr>
          </tbody></table>
        </td>
      </tr>
      <!-- Fin de Asignatura -->        
			      <!--  Inicio Asignatura -->
      <tr>
      	<td class="Estilo3">&nbsp;</td>
      </tr>
      <tr>
      	<td>
          <table width="100%" border="0" align="center" cellpadding="2" cellspacing="0" bgcolor="#CCCCCC">
          	<tbody><tr>
            	<td>
              	<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
                	<tbody><tr>
                  	<td width="100%" height="20" class="Estilo2">IS873 - LABORATORIO DE SOFTWARE - Grupo 2 </td>
                  </tr>
                                    <!-- Inicio Modulo -->
                  <tr>
                  	<td bgcolor="#FFFFFF"></td>
                  </tr>
                  <tr>
                  	<td bgcolor="#FFFFFF">
                    	<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
                      	<tbody><tr>
                        	<td width="27%" class="Estilo2">Módulo 1 Docente</td>
                          <td colspan="3" class="Estilo3">&nbsp;</td>
                        </tr>
                        <tr align="center">
                        	<td class="Estilo2">Nota del Definitiva</td>
                          <td class="Estilo2">Nota del Módulo</td>
                          <td class="Estilo2">Nota Habilitada</td>
                        </tr>
                        
                        <tr align="center">
                        	<td width="33%" class="Estilo3">1.5</td>
                          <td width="34%" class="Estilo3">1.5</td>
                          <td width="33%" class="Estilo3">No Aplica</td>
                        </tr>
                        <!--
                        <tr>
                        	<td class="Estilo2">Nota del M&oacute;dulo</td>
                          <td width="12%" class="Estilo3">&nbsp;</td>
                          <td width="40%" class="Estilo2" align="right">
                                                    Nota Habiliaci&oacute;n:
                                                    </td>
                          <td width="21%"><div align="center" class="Estilo3">
													&nbsp;</div></td>
                        </tr>
                        <tr>
                        	<td class="Estilo2" colspan="4">&nbsp;</td>
                        </tr>-->
                        <tr>
                        	<td colspan="4">
                          	<!-- Actividades -->
                          	<table width="100%" border="0" cellpadding="2" cellspacing="0" bgcolor="#EAEAEA">
                              <tbody><tr>
                                <td>
                                	<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
                                  	<tbody><tr>
                                    	<td width="44%" bgcolor="#CCCCCC" class="Estilo2">Actividad</td>
                                    	<td width="26%" bgcolor="#CCCCCC" align="center" class="Estilo2">Fecha Digitación</td>
                                    	<td width="14%" bgcolor="#CCCCCC" align="center" class="Estilo2">Porcentaje</td>
                                    	<td width="10%" bgcolor="#CCCCCC" align="center" class="Estilo2">Nota</td>
                                      
                                    </tr>
                                  	                                  	<tr bgcolor="#F4F4F4">
                                    	<td class="Estilo3">Entregable&nbsp;I&nbsp;</td>
                                    	<td align="center" class="Estilo3">29/03/23&nbsp;</td>
                                    	<td align="center" class="Estilo3">30 %&nbsp;</td>
                                    	<td align="center" class="Estilo3">5.000&nbsp;</td>
                                      
                                  	</tr>
                                  	                                	</tbody></table>
                                </td>
                              </tr>
                            </tbody></table>
                          	<!-- Fin Actividades -->                          
                          </td>
                        </tr>
                      </tbody></table>
                    </td>
                  </tr>
                  <!-- Fin Modulo -->
                                    <tr>
                    <td bgcolor="#FFFFFF" class="Estilo3" align="center">&nbsp;</td>
                  </tr>
                </tbody></table>
              </td>
            </tr>
          </tbody></table>
        </td>
      </tr>
      <!-- Fin de Asignatura -->        
			      <!--  Inicio Asignatura -->
      <tr>
      	<td class="Estilo3">&nbsp;</td>
      </tr>
      <tr>
      	<td>
          <table width="100%" border="0" align="center" cellpadding="2" cellspacing="0" bgcolor="#CCCCCC">
          	<tbody><tr>
            	<td>
              	<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
                	<tbody><tr>
                  	<td width="100%" height="20" class="Estilo2">IS053 - GERENCIA DE PROYECTOS - Grupo 101 </td>
                  </tr>
                                    <!-- Inicio Modulo -->
                  <tr>
                  	<td bgcolor="#FFFFFF"></td>
                  </tr>
                  <tr>
                  	<td bgcolor="#FFFFFF">
                    	<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
                      	<tbody><tr>
                        	<td width="27%" class="Estilo2">Módulo 1 Docente</td>
                          <td colspan="3" class="Estilo3">&nbsp;</td>
                        </tr>
                        <tr align="center">
                        	<td class="Estilo2">Nota del Definitiva</td>
                          <td class="Estilo2">Nota del Módulo</td>
                          <td class="Estilo2">Nota Habilitada</td>
                        </tr>
                        
                        <tr align="center">
                        	<td width="33%" class="Estilo3">1.3</td>
                          <td width="34%" class="Estilo3">1.3</td>
                          <td width="33%" class="Estilo3">No Aplica</td>
                        </tr>
                        <!--
                        <tr>
                        	<td class="Estilo2">Nota del M&oacute;dulo</td>
                          <td width="12%" class="Estilo3">&nbsp;</td>
                          <td width="40%" class="Estilo2" align="right">
                                                    Nota Habiliaci&oacute;n:
                                                    </td>
                          <td width="21%"><div align="center" class="Estilo3">
													&nbsp;</div></td>
                        </tr>
                        <tr>
                        	<td class="Estilo2" colspan="4">&nbsp;</td>
                        </tr>-->
                        <tr>
                        	<td colspan="4">
                          	<!-- Actividades -->
                          	<table width="100%" border="0" cellpadding="2" cellspacing="0" bgcolor="#EAEAEA">
                              <tbody><tr>
                                <td>
                                	<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
                                  	<tbody><tr>
                                    	<td width="44%" bgcolor="#CCCCCC" class="Estilo2">Actividad</td>
                                    	<td width="26%" bgcolor="#CCCCCC" align="center" class="Estilo2">Fecha Digitación</td>
                                    	<td width="14%" bgcolor="#CCCCCC" align="center" class="Estilo2">Porcentaje</td>
                                    	<td width="10%" bgcolor="#CCCCCC" align="center" class="Estilo2">Nota</td>
                                      
                                    </tr>
                                  	                                  	<tr bgcolor="#F4F4F4">
                                    	<td class="Estilo3">Parcial&nbsp;I&nbsp;</td>
                                    	<td align="center" class="Estilo3">04/04/23&nbsp;</td>
                                    	<td align="center" class="Estilo3">30 %&nbsp;</td>
                                    	<td align="center" class="Estilo3">4.400&nbsp;</td>
                                      
                                  	</tr>
                                  	                                	</tbody></table>
                                </td>
                              </tr>
                            </tbody></table>
                          	<!-- Fin Actividades -->                          
                          </td>
                        </tr>
                      </tbody></table>
                    </td>
                  </tr>
                  <!-- Fin Modulo -->
                                    <tr>
                    <td bgcolor="#FFFFFF" class="Estilo3" align="center">&nbsp;</td>
                  </tr>
                </tbody></table>
              </td>
            </tr>
          </tbody></table>
        </td>
      </tr>
      <!-- Fin de Asignatura -->        
			      <!--  Inicio Asignatura -->
      <tr>
      	<td class="Estilo3">&nbsp;</td>
      </tr>
      <tr>
      	<td>
          <table width="100%" border="0" align="center" cellpadding="2" cellspacing="0" bgcolor="#CCCCCC">
          	<tbody><tr>
            	<td>
              	<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
                	<tbody><tr>
                  	<td width="100%" height="20" class="Estilo2">IS924 - ARQUITECTURA CLIENTE/ SERVIDOR - Grupo 2 </td>
                  </tr>
                                    <!-- Inicio Modulo -->
                  <tr>
                  	<td bgcolor="#FFFFFF"></td>
                  </tr>
                  <tr>
                  	<td bgcolor="#FFFFFF">
                    	<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
                      	<tbody><tr>
                        	<td width="27%" class="Estilo2">Módulo 1 Docente</td>
                          <td colspan="3" class="Estilo3">&nbsp;</td>
                        </tr>
                        <tr align="center">
                        	<td class="Estilo2">Nota del Definitiva</td>
                          <td class="Estilo2">Nota del Módulo</td>
                          <td class="Estilo2">Nota Habilitada</td>
                        </tr>
                        
                        <tr align="center">
                        	<td width="33%" class="Estilo3">0.0</td>
                          <td width="34%" class="Estilo3">0.0</td>
                          <td width="33%" class="Estilo3">No Aplica</td>
                        </tr>
                        <!--
                        <tr>
                        	<td class="Estilo2">Nota del M&oacute;dulo</td>
                          <td width="12%" class="Estilo3">&nbsp;</td>
                          <td width="40%" class="Estilo2" align="right">
                                                    Nota Habiliaci&oacute;n:
                                                    </td>
                          <td width="21%"><div align="center" class="Estilo3">
													&nbsp;</div></td>
                        </tr>
                        <tr>
                        	<td class="Estilo2" colspan="4">&nbsp;</td>
                        </tr>-->
                        <tr>
                        	<td colspan="4">
                          	<!-- Actividades -->
                          	<table width="100%" border="0" cellpadding="2" cellspacing="0" bgcolor="#EAEAEA">
                              <tbody><tr>
                                <td>
                                	<table width="100%" border="0" cellpadding="0" cellspacing="0" bgcolor="#FFFFFF">
                                  	<tbody><tr>
                                    	<td width="44%" bgcolor="#CCCCCC" class="Estilo2">Actividad</td>
                                    	<td width="26%" bgcolor="#CCCCCC" align="center" class="Estilo2">Fecha Digitación</td>
                                    	<td width="14%" bgcolor="#CCCCCC" align="center" class="Estilo2">Porcentaje</td>
                                    	<td width="10%" bgcolor="#CCCCCC" align="center" class="Estilo2">Nota</td>
                                      
                                    </tr>
                                  	                                  	<tr bgcolor="#F4F4F4">
                                    	<td class="Estilo3">Tareas&nbsp;</td>
                                    	<td align="center" class="Estilo3">10/03/23&nbsp;</td>
                                    	<td align="center" class="Estilo3">40 %&nbsp;</td>
                                    	<td align="center" class="Estilo3">0.000&nbsp;</td>
                                      
                                  	</tr>
                                  	                                	</tbody></table>
                                </td>
                              </tr>
                            </tbody></table>
                          	<!-- Fin Actividades -->                          
                          </td>
                        </tr>
                      </tbody></table>
                    </td>
                  </tr>
                  <!-- Fin Modulo -->
                                    <tr>
                    <td bgcolor="#FFFFFF" class="Estilo3" align="center">&nbsp;</td>
                  </tr>
                </tbody></table>
              </td>
            </tr>
          </tbody></table>
        </td>
      </tr>
      <!-- Fin de Asignatura -->        
			      <tr>
        <td class="Estilo3">&nbsp;</td>
      </tr>
      <tr>
      	<td class="Estilo2"><div align="justify">
      	  <p>Tenga en cuenta que tienen cinco (5) días calendario a partir de la fecha de digitación para hacer algún reclamo de su nota.</p>
      	  <p>Las notas fueron calculadas según el Artículo 83, parágrafo 1 del Reglamento Estudiantil</p>
      	</div></td>
      </tr>
          </tbody></table>
	

</body></html>
`
const regexeachsubjectarea =/<!--  Inicio Asignatura -->/;
const regexeachName = /<td width="100%" height="20" class="Estilo2">(?<name>.+?)<\/td>/
const regexFinalGrade = /<td width="33%" class="Estilo3">(?<grade>.+?)<\/td>/
const regexGrades = /<td class="Estilo3">(?<name>.+?)<\/td>\n(\s)*<td align="center" class="Estilo3">(?<date>.+?)<\/td>\n\s*<td align="center" class="Estilo3">(?<porcentage>.+?)<\/td>\n\s*<td align="center" class="Estilo3">(?<grade>.+?)<\/td>/gm

const makeMessage = (values) => {

  const allmessages = []
  
  for(const value of values){
    let message = ""
    if(value.name === undefined) continue;
    message += `${value.name}\n`;
    message += `Nota definitiva: ${value.grade}\n`;
    for(const individualGrade of value.value){
        message += ` ${individualGrade.name} - ${individualGrade.porcentage}: ${individualGrade.grade}\n`;
    }
    allmessages.push(message)
  }

  return allmessages;
}

const readHTML = (html) => {
  const notasUser = []

  for(const element of html.split(regexeachsubjectarea)){
    let subjectAreaName
    let subjectAreaValue
    const subjectAreaGrade = []
    // subject area Name:
    const name = element.match(regexeachName);
    if(name !== null){
      subjectAreaName = name.groups.name.split(" -")[1].slice(1)
    }

    // subject area Grade:
    const grade = element.match(regexFinalGrade);
    if(grade !== null){
      subjectAreaValue = grade.groups.grade
    }

    for(const grades of element.matchAll(regexGrades)){
      const tochange = /&nbsp;/g
      const grade = {}
      grade.name = grades.groups.name.replace(tochange, " ")
      grade.date = grades.groups.date.replace(tochange, "")
      grade.porcentage = grades.groups.porcentage.replace(tochange, "").replace(" ", "")
      grade.grade = grades.groups.grade.replace(tochange, "")
      subjectAreaGrade.push(grade)
    }
    // console.log(notas)
    notasUser.push({name: subjectAreaName, grade: subjectAreaValue, value: subjectAreaGrade});
  } 
  const messages = makeMessage(notasUser)
  return messages
}

export { readHTML }
